<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Agenda da Juju NÃ³brega â€” Pessoal</title>
  <link rel="icon" href="https://images.unsplash.com/photo-1503264116251-35a269479413?ixlib=rb-4.0.3&auto=format&fit=crop&w=80&q=60">

  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#8a4e86">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&family=Oswald:wght@500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#fffafc; /* suave rosa/creme */
      --deep:#3b2f40; /* tom principal */
      --muted:#7d6a7d;
      --accent:#f3a6c6; /* rosa suave */
      --gold:#e6bf6a;
      --card:#ffffff;
      --success:#2ea44f;
      --danger:#e25555;
      --glass: rgba(255,255,255,0.7);

      --gap:1rem;
      --radius:12px;
      --shadow: 0 6px 18px rgba(61,43,70,0.06);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:var(--deep);display:flex;flex-direction:column;align-items:stretch}

    header{display:flex;align-items:center;gap:14px;padding:18px 22px;background:linear-gradient(90deg,var(--deep),#7b4f72);color:white;border-bottom:6px solid var(--accent);position:sticky;top:0;z-index:100}
    header img{width:64px;height:64px;border-radius:14px;object-fit:cover;border:3px solid rgba(255,255,255,0.12)}
    header .title{display:flex;flex-direction:column}
    header h1{font-family:Oswald, sans-serif;font-size:1.2rem;letter-spacing:0.06em}
    header p{font-size:0.85rem;opacity:0.95}

    main{max-width:1200px;margin:22px auto;padding:22px;width:100%;display:flex;flex-direction:column;gap:18px}

    /* Form */
    .panel{background:var(--card);padding:18px;border-radius:var(--radius);box-shadow:var(--shadow);border:1px solid rgba(125,106,125,0.06)}
    form label{display:block;margin-bottom:6px;font-weight:600;color:var(--muted)}
    input[type=date], input[type=time], input[type=text], select, textarea{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(125,106,125,0.06);margin-bottom:12px}
    textarea{min-height:80px}

    .actions{display:flex;gap:10px;align-items:center}
    .btn{padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
    .btn-primary{background:linear-gradient(180deg,var(--deep),#5a3a54);color:white}
    .btn-ghost{background:transparent;border:1px solid rgba(125,106,125,0.08);color:var(--deep)}

    /* Week nav */
    .week-nav{display:flex;align-items:center;justify-content:center;gap:12px;padding:10px;border-radius:10px;background:linear-gradient(180deg,rgba(111,74,123,0.05),transparent);box-shadow:0 4px 10px rgba(61,43,70,0.03)}
    .week-nav .range{font-weight:800;color:var(--deep)}

    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
    .day{background:var(--card);border-radius:12px;padding:14px;box-shadow:var(--shadow);border:1px solid rgba(125,106,125,0.04);display:flex;flex-direction:column;min-height:260px}
    .day h3{font-family:Oswald;font-size:1.05rem;margin-bottom:8px;color:var(--deep);border-bottom:3px solid rgba(243,166,198,0.18);padding-bottom:8px}

    .list{overflow:auto;flex-grow:1;padding-right:6px}
    .item{border-radius:10px;padding:10px;margin-bottom:10px;border-left:6px solid var(--muted);background:linear-gradient(180deg,#fff,#fff);box-shadow:0 2px 6px rgba(61,43,70,0.03)}
    .item.completed{background:#f6fff6;border-left-color:#81c784;opacity:0.95}
    .item .meta{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .item strong{color:var(--deep)}
    .item small{color:var(--muted)}

    .item .desc{font-size:0.9rem;color:var(--muted);margin-top:6px}
    .item .controls{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
    .circle-btn{width:36px;height:36px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;border:none;cursor:pointer}
    .edit{background:linear-gradient(180deg,#6f4a7b,#5a3a54);color:white}
    .del{background:linear-gradient(180deg,#ff8b8b,#e25555);color:white}
    .done{background:linear-gradient(180deg,#2ea44f,#1f8a37);color:white}

    .divider{border-top:2px dashed rgba(125,106,125,0.12);margin:12px 0;position:relative}
    .divider::before{content:'ALMOÃ‡O';position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:var(--card);padding:0 8px;font-weight:800;color:var(--muted)}

    .no{font-style:italic;color:var(--muted);text-align:center;padding:18px}

    .export{display:flex;justify-content:center;padding:8px}

    footer{padding:14px;text-align:center;color:var(--muted);font-size:0.9rem}

    @media (max-width:600px){header h1{font-size:1rem} .day{min-height:200px}}
  </style>
</head>
<body>
  <header>
    <img src="https://images.unsplash.com/photo-1503264116251-35a269479413?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=60" alt="Juju">
    <div class="title"><h1>Agenda da Juju NÃ³brega</h1><p>Organize seu dia a dia â€” tarefas, compromissos e notas</p></div>
  </header>

  <main>
    <!-- Form panel -->
    <section class="panel">
      <form id="form-agendamento">
        <div id="message-container" class="message"></div>

        <label for="data">Data</label>
        <input type="date" id="data" required>

        <label for="horario">HorÃ¡rio</label>
        <input type="time" id="horario" required>

        <label for="cliente">TÃ­tulo (curto)</label>
        <input type="text" id="cliente" placeholder="Ex: Revisar apresentaÃ§Ã£o" required>

        <label for="descricao">DescriÃ§Ã£o (opcional)</label>
        <textarea id="descricao" placeholder="Detalhes..."></textarea>

        <label for="servico">Categoria</label>
        <select id="servico" required>
          <option value="">Selecione</option>
          <option value="Trabalho">Trabalho</option>
          <option value="Estudo">Estudo</option>
          <option value="Pessoal">Pessoal</option>
          <option value="SaÃºde">SaÃºde</option>
          <option value="Compras">Compras</option>
        </select>

        <input type="hidden" id="index-edicao" value="">
        <div class="actions">
          <button class="btn btn-primary" type="submit">Salvar Compromisso</button>
          <button type="button" class="btn btn-ghost" onclick="resetForm()">Limpar</button>
        </div>
      </form>
    </section>

    <!-- Week navigation -->
    <div class="week-nav panel">
      <button class="btn btn-ghost" onclick="mudarSemana(-1)">Anterior</button>
      <div class="range" id="semana-atual"></div>
      <button class="btn btn-ghost" onclick="mudarSemana(1)">PrÃ³xima</button>
    </div>

    <!-- Days grid -->
    <div class="grid" id="dias"></div>

    <div class="export panel export">
      <button class="btn btn-primary" onclick="gerarImagem()">Exportar agenda (PNG)</button>
    </div>
  </main>

  <footer>VersÃ£o PWA â€” Agenda pessoal</footer>

  <!-- Service worker registration -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js').catch(err => console.warn('SW registration failed:', err));
    }
  </script>

  <!-- Core script (keeps the same functionality) -->
  <script>
    // CÃ³digo mantido â€” gerenciamento de compromissos via localStorage
    let dataAtual = new Date();

    function showMessage(text, type='info'){
      const el = document.getElementById('message-container');
      el.textContent = text; el.className = 'message-container '+type; el.style.display='block';
      setTimeout(()=>{ el.style.display=''; el.className=''; },4200);
    }

    function getStartOfWeek(date){ const d=new Date(date); const day=d.getDay(); const diff=d.getDate()-(day===0?6:day-1); return new Date(d.getFullYear(),d.getMonth(),diff); }
    function formatarDataCurta(date){ const day=String(date.getDate()).padStart(2,'0'); const month=String(date.getMonth()+1).padStart(2,'0'); return `${day}/${month}`; }
    function formatarDataCompleta(date){ const options={weekday:'long',day:'2-digit',month:'2-digit'}; const f=date.toLocaleDateString('pt-BR',options); return f.charAt(0).toUpperCase()+f.slice(1); }
    function capitalize(s){ return s? s.charAt(0).toUpperCase()+s.slice(1):'' }

    function carregarAgendamentos(){
      const diasContainer = document.getElementById('dias'); diasContainer.innerHTML='';
      const startOfWeek = getStartOfWeek(dataAtual); const days=[];
      for(let i=0;i<7;i++){ const d=new Date(startOfWeek); d.setDate(startOfWeek.getDate()+i); days.push(d); }
      const end=new Date(startOfWeek); end.setDate(startOfWeek.getDate()+6);

      document.getElementById('semana-atual').textContent = `Semana de ${formatarDataCurta(startOfWeek)} a ${formatarDataCurta(end)}`;

      days.forEach(date=>{
        const key = date.toISOString().slice(0,10);
        let items = JSON.parse(localStorage.getItem(key))||[];
        items = items.map(it=>({...it, completed: it.hasOwnProperty('completed')?it.completed:false}));
        items.sort((a,b)=>a.horario.localeCompare(b.horario));
        localStorage.setItem(key, JSON.stringify(items));

        const dayEl = document.createElement('div'); dayEl.className='day panel';
        dayEl.innerHTML = `<h3>${formatarDataCompleta(date)}</h3>`;
        const list = document.createElement('div'); list.className='list';

        if(items.length===0){ list.innerHTML = '<div class="no">Nenhum compromisso para este dia.</div>'; }
        else{
          let lunch=false;
          items.forEach((it,idx)=>{
            if(it.horario>='12:00' && !lunch){ list.innerHTML += '<div class="divider"></div>'; lunch=true; }
            const item = document.createElement('div'); item.className = 'item '+(it.completed?'completed':'');
            item.innerHTML = `
              <div class="meta"><div><strong>${it.horario}</strong> <small> - ${capitalize(it.cliente)}</small></div><div><small>${it.servico}</small></div></div>
              <div class="desc">${it.descricao?it.descricao:''}</div>
              <div class="controls">
                <button class="circle-btn edit" onclick="editarAgendamento('${key}', ${idx})" title="Editar">âœŽ</button>
                <button class="circle-btn del" onclick="removerAgendamento('${key}', ${idx})" title="Remover">ðŸ—‘</button>
                <button class="circle-btn done" onclick="toggleConcluido('${key}', ${idx})" title="Concluir">âœ”</button>
              </div>
            `;
            list.appendChild(item);
          });
        }

        dayEl.appendChild(list);
        diasContainer.appendChild(dayEl);
      });
    }

    function salvarAgendamento(e){ e.preventDefault();
      const data=document.getElementById('data').value; const horario=document.getElementById('horario').value; const cliente=document.getElementById('cliente').value.trim(); const servico=document.getElementById('servico').value; const descricao=document.getElementById('descricao').value.trim(); const idx=document.getElementById('index-edicao').value;
      if(!data||!horario||!cliente||!servico){ showMessage('Preencha data, horÃ¡rio, tÃ­tulo e categoria','error'); return; }
      let arr=JSON.parse(localStorage.getItem(data))||[];
      if(arr.some((it,i)=>it.horario===horario && i!==parseInt(idx))){ showMessage('Conflito de horÃ¡rio, escolha outro horÃ¡rio','error'); return; }
      const novo={data,horario,cliente,servico,descricao,completed:false};
      if(idx!==''){ arr[parseInt(idx)]=novo; showMessage('Compromisso atualizado','success'); } else{ arr.push(novo); showMessage('Compromisso salvo','success'); }
      localStorage.setItem(data, JSON.stringify(arr));
      resetForm(); carregarAgendamentos();
    }

    function editarAgendamento(key,index){ const arr=JSON.parse(localStorage.getItem(key))||[]; const it=arr[index]; if(it){ document.getElementById('data').value=it.data; document.getElementById('horario').value=it.horario; document.getElementById('cliente').value=it.cliente; document.getElementById('servico').value=it.servico; document.getElementById('descricao').value=it.descricao||''; document.getElementById('index-edicao').value=index; showMessage('Edite e clique em Salvar Compromisso','info'); } }
    function removerAgendamento(key,index){ if(confirm('Remover compromisso?')){ const arr=JSON.parse(localStorage.getItem(key))||[]; arr.splice(index,1); localStorage.setItem(key, JSON.stringify(arr)); showMessage('Compromisso removido','success'); carregarAgendamentos(); } }
    function toggleConcluido(key,index){ const arr=JSON.parse(localStorage.getItem(key))||[]; if(arr[index]){ arr[index].completed=!arr[index].completed; localStorage.setItem(key, JSON.stringify(arr)); showMessage(arr[index].completed? 'Marcado como concluÃ­do':'Marcado como pendente','success'); carregarAgendamentos(); } }
    function mudarSemana(offset){ const cur=dataAtual.getDay(); const toMon=cur===0?6:cur-1; const monday=new Date(dataAtual); monday.setDate(dataAtual.getDate()-toMon); monday.setDate(monday.getDate()+(offset*7)); dataAtual=monday; carregarAgendamentos(); }
    function gerarImagem(){ const main=document.querySelector('main'); const header=document.querySelector('header'); const panels=document.querySelectorAll('.panel'); header.style.display='none'; panels.forEach(p=>p.style.display='none'); window.scrollTo(0,0);
      domtoimage.toPng(document.querySelector('main')).then(dataUrl=>{ const a=document.createElement('a'); a.href=dataUrl; a.download='agenda-juju-nobrega.png'; document.body.appendChild(a); a.click(); a.remove(); showMessage('Exportado como PNG','success'); }).catch(()=>showMessage('Erro ao exportar','error')).finally(()=>{ header.style.display='flex'; panels.forEach(p=>p.style.display='block'); }); }

    function resetForm(){ document.getElementById('form-agendamento').reset(); document.getElementById('index-edicao').value=''; }

    document.getElementById('form-agendamento').addEventListener('submit', salvarAgendamento);
    document.addEventListener('DOMContentLoaded',()=>{ carregarAgendamentos(); });
  </script>

  <!-- Manifest (create this file in the same folder as index.html) -->
  <!-- manifest.json -->
  <!--
  {
    "name": "Agenda Juju NÃ³brega",
    "short_name": "Agenda Juju",
    "start_url": ".",
    "display": "standalone",
    "background_color": "#fffafc",
    "theme_color": "#8a4e86",
    "icons": [
      { "src": "https://images.unsplash.com/photo-1503264116251-35a269479413?ixlib=rb-4.0.3&auto=format&fit=crop&w=192&q=60", "sizes": "192x192", "type": "image/png" },
      { "src": "https://images.unsplash.com/photo-1503264116251-35a269479413?ixlib=rb-4.0.3&auto=format&fit=crop&w=512&q=60", "sizes": "512x512", "type": "image/png" }
    ]
  }
  -->

  <!-- Service worker file: service-worker.js (create in the same folder) -->
  <!--
  const CACHE_NAME = 'agenda-juju-cache-v1';
  const FILES_TO_CACHE = [
    '/', '/index.html', '/manifest.json'
  ];

  self.addEventListener('install', (evt) => {
    evt.waitUntil(
      caches.open(CACHE_NAME).then((cache) => cache.addAll(FILES_TO_CACHE))
    );
    self.skipWaiting();
  });

  self.addEventListener('activate', (evt) => {
    evt.waitUntil(
      caches.keys().then((keyList) => Promise.all(
        keyList.map((key) => { if (key !== CACHE_NAME) return caches.delete(key); })
      ))
    );
    self.clients.claim();
  });

  self.addEventListener('fetch', (evt) => {
    evt.respondWith(
      caches.match(evt.request).then((response) => response || fetch(evt.request))
    );
  });
  -->

  <!-- Illustration guidance:
       I did NOT use copyrighted "Powerpuff Girls" images. Instead, use free/royalty-free superheroine illustrations.
       Good sources: undraw.co (free, permissive), unplash (photos), or create custom SVGs.
       Example open-source illustration to use as header or icons:
       - https://undraw.co/illustrations (search "superhero")
       - https://unsplash.com/s/photos/superhero-girl (photos)
  -->
</body>
</html>
